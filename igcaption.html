<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type="text/javascript" src="/hackeroverflow/js/coordinates.js" charset="UTF-8"></script>
    <title>summa</title>

    <style>

@import url('https://fonts.googleapis.com/css?family=Montserrat:100,200,300,400,500,600,700,800,900');

        html,body{

            margin: 0;

            overflow: hidden;
        }

        html{
            background-color: #F2F2F6;
        }

        .background-wave{
            z-index: -1;
            position: absolute;
        }

        #main{
            height: 100vh;
            width: 375px;
            margin: auto;
            z-index: 5;
            display: grid;
            grid-template-rows: 75px 300px 135px;
            grid-row-gap: 20px;

        }

        .heading-bar{
            font-family: Montserrat-Bold;
            font-size: 20px;
            color: #FFFFFF;
            text-align: center;
            top: 30px;
            position: relative;


        }

        .editorbox{

            height: 100%;
            width: inherit;
            background: #ffffff;
            border: 1px solid rgba(205,208,227,0.30);
            border-radius: 24px;

        }

        #fontChosen{
            background-color: #0000AF;
            border-radius: 4px;
            font-family: Montserrat-Medium;
            font-size: 16px;
            color: #FFFFFF;
            border: #0000AF;
            padding-left: 18px;
            padding-right: 18px;
            max-width: 150px;

        }

        .editor-header-text{

            font-family: Montserrat-Medium;
            font-size: 16px;
            color: #0000AF;
            display: flex;
            justify-content: center;
            align-items: center;


        }

        .droparrow{

            background: #F0EDED;
            border-radius: 4px;
            padding-left: 9px;
            padding-right: 11px;
            padding-top: 6px;
            padding-bottom: 6px;

        }

        .editor-header{

            margin-top: 20px;
            margin-left: 20px;
            display: grid;
            grid-template-columns: 94px 190px;
            grid-column-gap: 10px;
            width: 99%;
            height: 30px;

        }

        .textarea{

            margin-top: 12px;
            width: 87%;
            height: 435px;
            margin-left: 20px;
            resize: none;
            border: none;
            outline: none;
            font-family: 'Roboto Thin', 'Helvetica Neue',sans-seriff;
            font-size: 16px;

        }

        .editorbox-footer{

            opacity: 0.5;
            font-family: Montserrat-Medium;
            font-size: 14px;
            color: #0000AF;
            margin-top: 3px;

        }

        .footer{

            display: grid;
            grid-template-rows: 60px 50px;
            grid-row-gap: 15px;

        }

        .footer-text{

            font-family: Montserrat-SemiBold;
            font-size: 14px;
            color: #0000AF;
            text-align: right;

        }

        .copybutton{

            background: #0000AF;
            border-radius: 10px;
            font-family: Montserrat-Bold;
            font-size: 16px;
            color: #FFFFFF;
            display: flex;
            justify-content: center;
            align-items: center;

        }

        .dropdown-content {

        position: absolute;
        background-color: #FAFAFF;
        min-width: 190px;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        z-index: 1;
        margin-top: 30px;
            max-height: 116px;
            overflow: scroll;

}

#editor::selection {
    background: rgba(8, 8, 255, 0.45);
}
#editor::-moz-selection {
    background: rgba(8, 8, 255, 0.45);
}


.dropdown-content div {
  color: black;
  padding: 8px 16px;
  text-decoration: none;
  display: block;
  font-family: 'Roboto Thin', 'Helvetica Neue',sans-seriff;
}

.tagname{

    background-color: #FAFAFF;
    height: 257px;
    width:275px;
    position: absolute;
    /*border: gray 1px solid;*/
    box-shadow: 0.4px 0.4px 0.4px 0.4px gray;
    overflow: scroll;
    margin-left: 30px;
    border: 2px solid rgba(205,208,227,0.30);
    border-radius: 10px;

}

    </style>

</head>
<body>

<!--<div class="background-wave">-->
<!--    <svg width="375px" height="500px" viewBox="0 0 375 500" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">-->
<!--        <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">-->
<!--            <path d="M0,0 L1680,0 L1680,392.225832 C1439.55589,248.526941 1160.85686,248.526941 843.902904,392.225832 C526.948947,535.924723 245.647979,535.924723 0,392.225832 L0,0 Z" id="Rectangle-Copy-4" fill="#0000AF"></path>-->
<!--        </g>-->
<!--    </svg>-->
<!--</div>-->


<img src="/hackeroverflow/images/rect-500.svg" class="background-wave" id="bgimg-wave">

<section class="mainbox" id="main">

    <div class="heading-bar">IGCAPTION</div>

    <div style="background-color: white" class="editorbox">

        <div class="editor-header">

            <div class="editor-header-text">Text Styles :</div>

            <div style="display: grid;grid-template-columns: 150px 30px;grid-column-gap: 10px;">
            <button id="fontChosen" style="outline: none" data-font="NORMAL">Normal</button>
            <div class="droparrow" onclick="fun(this)" data-dropped="false" id="font">
                <svg width="12px" height="7px" viewBox="0 0 12 7" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round">
                        <g id="main-page" transform="translate(-881.000000, -126.000000)" stroke="#0000AF" stroke-width="2">
                            <polyline id="back" points="892 127 887 132 882 127"></polyline>
                        </g>
                    </g>
                </svg></div>
                <div class="dropdown-content" id="dropdown-content">
                    <div data-value="NORMAL" data-font="Normal" onclick="changeValue(this)">Normal &nbsp;(Default)</div>
                    <div data-value="NORMAL_SANS" data-font="Sans" onclick="changeValue(this)">𝖭𝗈𝗋𝗆𝖺𝗅 𝖲𝖺𝗇𝗌</div>
                    <div data-value="BOLD_SANS" data-font="Bold Sans" onclick="changeValue(this)">𝗕𝗼𝗹𝗱 𝗦𝗮𝗻𝘀</div>
                    <div data-value="ITALIC_SANS" data-font="Italic Sans" onclick="changeValue(this)">𝘐𝘵𝘢𝘭𝘪𝘤 𝘚𝘢𝘯𝘴</div>
                    <div data-value="BOLD_ITALIC_SANS" data-font="Boltalic Sans" onclick="changeValue(this)">𝘽𝙤𝙡𝙙 & 𝙄𝙩𝙖𝙡𝙞𝙘 𝙎𝙖𝙣𝙨</div>
                    <div data-value="BUBBLE_TEXT_BLACKED" data-font="Bubble" onclick="changeValue(this)">🅑🅤🅑🅑🅛🅔</div>
                    <div data-value="SQUARE_TEXT_NORMAL" data-font="Square - 1" onclick="changeValue(this)">🅂🅀🅄🄰🅁🄴 - 1</div>
                    <div data-value="SQUARE_TEXT_BLACKED" data-font="Square - 2" onclick="changeValue(this)">🆂🆀🆄🅰🆁🅴 - 2</div>
                    <div data-value="MONOSPACE_TEXT" data-font="Monospace" onclick="changeValue(this)">𝙼𝚘𝚗𝚘𝚜𝚙𝚊𝚌𝚎</div>
                    <div data-value="SPACING_TEXT" data-font="Spacer" onclick="changeValue(this)">Ｓｐａｃｅｒ</div>
                </div>
            </div>


        </div>
<center>
        <div style="margin-top: 12px;">

            <svg width="302px" height="9px" viewBox="0 0 302 9" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" opacity="0.0994233631">
                    <g id="main-page-copy" transform="translate(-689.000000, -236.000000)" fill="#000000" fill-rule="nonzero">
                        <path id="Path-3-Copy" d="M990.486664,235.998356 L990.51333,243.998311 L989.513336,244.001644 L989.501,240.501 L690.501,241.497 L690.51333,244.998311 L689.513336,245.001644 L689.48667,237.001689 L690.486664,236.998356 L690.498,240.498 L989.498,239.502 L989.48667,236.001689 L990.486664,235.998356 Z"></path>
                    </g>
                </g>
            </svg>

        </div>
</center>

        <textarea class="textarea" id="editor" placeholder="Write Your Caption..." autocapitalize="off" autocomplete="off"></textarea>

        <center>
            <div style="margin-top: 10px;">

                <svg width="302px" height="9px" viewBox="0 0 302 9" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" opacity="0.0994233631">
                        <g id="main-page-copy" transform="translate(-689.000000, -236.000000)" fill="#000000" fill-rule="nonzero">
                            <path id="Path-3-Copy" d="M990.486664,235.998356 L990.51333,243.998311 L989.513336,244.001644 L989.501,240.501 L690.501,241.497 L690.51333,244.998311 L689.513336,245.001644 L689.48667,237.001689 L690.486664,236.998356 L690.498,240.498 L989.498,239.502 L989.48667,236.001689 L990.486664,235.998356 Z"></path>
                        </g>
                    </g>
                </svg>

            </div>
        </center>

        <div class="editorbox-footer">
            <center>Type “:” to get emoji suggestions</center>

        </div>

    </div>

    <div class="footer">
        <div>
        <div class="footer-text" style="margin-top: 1px"><span id="lineCount">0</span> Line breaks generated</div>
        <div class="footer-text" style="margin-top: 3px;"><span id="charCount">0</span> / 2200 Characters</div>
        <div class="footer-text" style="margin-top: 3px;"><span id="hashTagsCount">0</span> / 30 Hastags</div>
    </div>
        <div class="copybutton">

            COPY & CONVERT

        </div></div>

    <div class="tagname" id="tag-name" style=""></div>
</section>



<script>

    var fonts;
    var xhttp =null;

    var div=document.getElementById('editor');

    window.onload=async function () {

        var url="http://192.168.1.6:8080/hackeroverflow/json/fonts.json";
        xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (this.readyState === 4 && this.status === 200) {

                fonts=JSON.parse(this.responseText);

            }

        }

        xhttp.open("GET", url, true);
        xhttp.send();


    }

    $(document).ready(function() {

        document.getElementById('dropdown-content').style.display='none';
        document.getElementById('tag-name').style.display='none';
        var firstRow = 50;
        var secondRow = $(window).height() - 120 - 50 - 20 - 20 - 25;
        var thirdRow = 120;
        document.getElementById("main").style.gridTemplateRows = firstRow + "px " + secondRow + "px " + thirdRow + "px";
        document.getElementById("editor").style.height=(secondRow-168)+"px";
console.log(secondRow);
        if ($(window).width() < 415) {
            document.getElementById('main').style.width = $(window).width() - 30 + "px";

        }

        if($(window).height()<400){
            document.getElementById('bgimg-wave').setAttribute("src","/hackeroverflow/images/rect-200.svg");
        }
        else if($(window).height()<600){
            document.getElementById('bgimg-wave').setAttribute("src","/hackeroverflow/images/rect-300.svg")
        }
        else if($(window).height()<750){
            document.getElementById('bgimg-wave').setAttribute("src","/hackeroverflow/images/rect-400.svg")
        }
        else{
            document.getElementById('bgimg-wave').setAttribute("src","/hackeroverflow/images/rect-500.svg")
        }
    });

    $(window).resize(function() {

        var firstRow=50;
        var secondRow=$(window).height()-120-50-20-20-25;
        var thirdRow=120;
        document.getElementById("main").style.gridTemplateRows=firstRow+"px "+secondRow+"px "+thirdRow+"px";
        document.getElementById("editor").style.height=(secondRow-168)+"px";

        if($(window).width()<415) {
            document.getElementById('main').style.width =$(window).width()-30+"px";

        }
        else{
            document.getElementById('main').style.width="375px";
        }

        if($(window).height()<400){
            document.getElementById('bgimg-wave').setAttribute("src","/hackeroverflow/images/rect-200.svg");
        }
        else if($(window).height()<600){
            document.getElementById('bgimg-wave').setAttribute("src","/hackeroverflow/images/rect-300.svg")
        }
        else if($(window).height()<750){
            document.getElementById('bgimg-wave').setAttribute("src","/hackeroverflow/images/rect-400.svg")
        }
        else{
            document.getElementById('bgimg-wave').setAttribute("src","/hackeroverflow/images/rect-500.svg")
        }

    });

    function fun() {

        if(document.getElementById('dropdown-content').style.display==='none'){
            document.getElementById('dropdown-content').style.display='block';
        }
        else{
            document.getElementById('dropdown-content').style.display='none';
        }
        document.getElementById('editor').focus();

    }

    function changeValue(e){

        var el = document.getElementById("fontChosen");
        el.setAttribute("data-font",e.getAttribute("data-value"));
        el.innerHTML=e.getAttribute("data-font");
        var txtarea = document.getElementById("editor");
        var start = txtarea.selectionStart;
        var finish = txtarea.selectionEnd;
        var sel = txtarea.value.substring(start, finish);
        document.getElementById('dropdown-content').style.display='none';
        replaceSelectedText(document.getElementById("editor"),sel,"selectionReplace");
        document.getElementById('charCount').innerHTML=countCharactersInTextArea(document.getElementById('editor'));
        document.getElementById('hashTagsCount').innerHTML=hashTagCountInGivenText(document.getElementById('editor').value);

    }


    function countCharactersInTextArea(element) {

        return element.value.length;

    }

    function countLineNumberInTextArea(element) {

        var noOfLines=element.value.split(/\r*\n/);

        return noOfLines.length;

    }

    function hashTagCountInGivenText(text) {

        var hashTagRegex = /^#[a-z0-9]/g;
        var hashTags = 0;
        var textSpaceSplit=text.split(/[ |\n]/);

        for(var z=0;z<textSpaceSplit.length;z++) {
            if (textSpaceSplit[z].match(hashTagRegex)!==null) {
                hashTags += 1;

            }
        }

        if(hashTags>30){
            document.getElementById("alert").innerHTML = "Hashtag limit 30, remove others!";
            document.getElementById("alert").style.display="";
            document.getElementById("editor").blur();

            setTimeout(function(){
                document.getElementById("alert").innerHTML = '';
                document.getElementById("alert").style.display="none";
            }, 1000);
        }

        return hashTags;
    }


    function replaceSelectedText(el, text, todo,length) {

        var sel;
        var newText;

        if(todo==="selectionReplace") {
            sel = getInputSelection(el), val = el.value;
            newText = oldTextToNewOmitHashAndTagname(text);
            el.value = val.slice(0, sel.start) + newText + val.slice(sel.end);
            el.focus();
            el.selectionStart = sel.start;
            el.selectionEnd = sel.start + newText.length;
        }
        else if(todo==="insertAtCaret"){

            insertAtCaret("editor",text)

        }
        else if(todo==="swipedText"){

            sel = getInputSelection(el), val = el.value;
            newText = oldTextToNewOmitHashAndTagname(text);
            el.value = val.slice(0, sel.start-length) + newText + val.slice(sel.end);
            el.focus();
        }


        return true;
    }

    function getInputSelection(el) {
        var start = 0, end = 0, normalizedValue, range,
            textInputRange, len, endRange;

        if (typeof el.selectionStart == "number" && typeof el.selectionEnd == "number") {
            start = el.selectionStart;
            end = el.selectionEnd;
        } else {
            range = document.selection.createRange();

            if (range && range.parentElement() === el) {
                len = el.value.length;
                normalizedValue = el.value.replace(/\r\n/g, "\n");

                // Create a working TextRange that lives only in the input
                textInputRange = el.createTextRange();
                textInputRange.moveToBookmark(range.getBookmark());

                // Check if the start and end of the selection are at the very end
                // of the input, since moveStart/moveEnd doesn't return what we want
                // in those cases
                endRange = el.createTextRange();
                endRange.collapse(false);

                if (textInputRange.compareEndPoints("StartToEnd", endRange) > -1) {
                    start = end = len;
                } else {
                    start = -textInputRange.moveStart("character", -len);
                    start += normalizedValue.slice(0, start).split("\n").length - 1;

                    if (textInputRange.compareEndPoints("EndToEnd", endRange) > -1) {
                        end = len;
                    } else {
                        end = -textInputRange.moveEnd("character", -len);
                        end += normalizedValue.slice(0, end).split("\n").length - 1;
                    }
                }
            }
        }

        return {
            start: start,
            end: end
        };
    }

    function oldTextToNewOmitHashAndTagname(text) {

        var spaceSplitArray=text.split("\n");
        var newTextArrayToJoin=[];
        var tagNameRegex = /^@[^@#]+$/g;

        for(var t=0;t<spaceSplitArray.length;t++){
            var spaceseparate=spaceSplitArray[t].split(" ");
            var spaceArrayToJoin=[];
            var spaceJoinString="";

            for(var s=0;s<spaceseparate.length;s++){
                if(spaceseparate[s]===""){
                    spaceArrayToJoin.push("");
                }
                else if(spaceseparate[s].match(tagNameRegex)){
                    spaceArrayToJoin.push(spaceseparate[s]);
                }
                else{
                    spaceArrayToJoin.push(changeFontStyleForGivenText(spaceseparate[s],document.getElementById("fontChosen").getAttribute("data-font")));
                }
            }
            spaceJoinString=spaceArrayToJoin.join(" ");
            newTextArrayToJoin.push(spaceJoinString);
        }

        return newTextArrayToJoin.join("\n");
    }

    function changeFontStyleForGivenText(oldText,toFontName) {

        var newtext="";
        var oldTextArray=[...oldText];
        for (x=0;x<oldTextArray.length;x++) {

            var char = oldTextArray[x];
            var regexCheckArray = fonts["REGEXCHECK"];
            var fontStyleOject = fonts[toFontName];
            var bool = false;
            var indexNumber = 0;
            var identity;
            var normalChar;
            var newchar;
            var caps = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";   //10 types of fonts contains caps.
            var small = "abcdefghijklmnopqrstuvwxyz";  //10 types of fonts contains small.
            var number = "0123456789";    // 7 types of fonts contains numbers.

            for (var i = 0; i < regexCheckArray.length; i++) {
                if (bool === false) {
                    if ([...regexCheckArray[i]["LIST"]].indexOf(char) !== -1) {
                        indexNumber = [...regexCheckArray[i]["LIST"]].indexOf(char);
                        identity = regexCheckArray[i]["NAME"];

                        if (identity === "number") {
                            normalChar = number[indexNumber%10];
                        } else if (identity === "small") {
                            normalChar = small[indexNumber%26];
                        } else if (identity === "caps") {
                            normalChar = caps[indexNumber%26];
                        }
                        bool=true;
                    }
                }
            }

            if (bool === true) {
                if(fontStyleOject["STATUS"]["containsall"][2] === "s") {
                    if (fontStyleOject["STATUS"]["containsall"][0] === "0") {
                        if (fontStyleOject["STATUS"]["notcontains"].includes(identity)) {
                            newchar=changeTheCodePointsFont("A","A","a","a","0","0",normalChar);
                        }
                        else {
                            newchar = changeTheCodePointsFont(fontStyleOject["CAPSFIRST"],"A",fontStyleOject["SMALLFIRST"],"a",fontStyleOject["NUMBERFIRST"],"0",normalChar);
                        }
                    }
                    else {
                        newchar = changeTheCodePointsFont(fontStyleOject["CAPSFIRST"],"A",fontStyleOject["SMALLFIRST"],"a",fontStyleOject["NUMBERFIRST"],"0",normalChar);
                    }
                }
                else{
                    if(fontStyleOject["STATUS"]["exceptionlist"].indexOf(normalChar)!==-1){
                        newchar=[...fontStyleOject["STATUS"]["changeto"]][fontStyleOject["STATUS"]["exceptionlist"].indexOf(normalChar)];
                    }
                    else {
                        if (fontStyleOject["STATUS"]["containsall"][0] === "0") {
                            if (fontStyleOject["STATUS"]["notcontains"].includes(identity)) {
                                newchar = changeTheCodePointsFont("A","A","a","a","0","0",normalChar);
                            }
                            else {
                                newchar = changeTheCodePointsFont(fontStyleOject["CAPSFIRST"],"A",fontStyleOject["SMALLFIRST"],"a",fontStyleOject["NUMBERFIRST"],"1",normalChar);
                            }
                        }
                        else {
                            newchar = newchar = changeTheCodePointsFont(fontStyleOject["CAPSFIRST"],"A",fontStyleOject["SMALLFIRST"],"a",fontStyleOject["NUMBERFIRST"],"1",normalChar);
                        }
                    }
                }
            }
            else {
                newchar = char;
            }

            newtext += newchar;
        }

        return newtext;
    }

    function changeTheCodePointsFont(row1,col1,row2,col2,row3,col3,normalChar){

        var diff;
        var char;

        if (/[A-Z]/.test(normalChar)) {
            diff = row1.codePointAt(0) - col1.codePointAt(0);
        } else if (/[a-z]/.test(normalChar)) {
            diff = row2.codePointAt(0) - col2.codePointAt(0);
        } else if (/[0-9]/.test(normalChar)) {
            diff = row3.codePointAt(0) - col3.codePointAt(0);
        }
        char = String.fromCodePoint(normalChar.codePointAt(0) + diff);

        return char;

    }

    function ReturnWord(text, caretPos) {
        var index = text.indexOf(caretPos);
        var preText = text.substring(0, caretPos);
        if (preText.indexOf(" ") >= 0 || preText.indexOf("\n")>=0) {
            var words = preText.split(/[ |\n]/);
            return words[words.length - 1]; //return last word
        }
        else {
            return preText;
        }
    }

    function AlertPrevWord() {
        var text = document.getElementById("editor");
        var caretPos = GetCaretPosition(text)
        var word = ReturnWord(text.value, caretPos);
        if (word != null) {
            return word;
        }
        else{
            return "";
        }

    }

    function GetCaretPosition(ctrl) {
        var CaretPos = 0;   // IE Support
        if (document.selection) {
            ctrl.focus();
            var Sel = document.selection.createRange();
            Sel.moveStart('character', -ctrl.value.length);
            CaretPos = Sel.text.length;
        }
        // Firefox support
        else if (ctrl.selectionStart || ctrl.selectionStart === '0')
            CaretPos = ctrl.selectionStart;
        return (CaretPos);
    }


    function insertAtCaret(areaId, text) {
        var txtarea = document.getElementById(areaId);
        if (!txtarea) {
            return;
        }

        var scrollPos = txtarea.scrollTop;
        var strPos = 0;
        var br = ((txtarea.selectionStart || txtarea.selectionStart === '0') ?
            "ff" : (document.selection ? "ie" : false));
        if (br === "ie") {
            txtarea.focus();
            var range = document.selection.createRange();
            range.moveStart('character', -txtarea.value.length);
            strPos = range.text.length;
        } else if (br === "ff") {
            strPos = txtarea.selectionStart;
        }

        var front = (txtarea.value).substring(0, strPos);
        var back = (txtarea.value).substring(strPos, txtarea.value.length);
        txtarea.value = front.substring(0,front.length-1) + text + back;
        strPos = strPos-1 + text.length;
        if (br === "ie") {
            txtarea.focus();
            var ieRange = document.selection.createRange();
            ieRange.moveStart('character', -txtarea.value.length);
            ieRange.moveStart('character', strPos);
            ieRange.moveEnd('character', 0);
            ieRange.select();
        } else if (br === "ff") {
            txtarea.selectionStart = strPos;
            txtarea.selectionEnd = strPos;
            txtarea.focus();
        }

        txtarea.scrollTop = scrollPos;
    }


var input="";



    //  function keypress(evt) {
    //
    //     alert(1);
    //     evt = evt || window.event;
    //     var charCode = (typeof evt.which == "undefined") ? evt.keyCode : evt.which;
    //     var charStr = String.fromCharCode(charCode);
    //     var ch;
    //     if(document.getElementById("fontChosen").getAttribute("data-font")==="NORMAL"){
    //
    //         //boooooom........
    //         ch=charStr;
    //
    //     }
    //     else{
    //         if (charCode === 13 || charStr === " ") {
    //             //magic happens........
    //             ch=charStr;
    //
    //         } else if (charCode) {
    //
    //             var fontName = document.getElementById("fontChosen").getAttribute("data-font");
    //             ch = changeFontStyleForGivenText(charStr, fontName);
    //             replaceSelectedText(document.getElementById('editor'), ch,"insertAtCaret");
    //             return false;
    //         }
    //     }
    //     document.getElementById('charCount').innerHTML=div.value.length+ch.length;
    // }

    // document.getElementById('editor').onkeyup=function (event) {
    //
    //
    //     document.getElementById('charCount').innerHTML=countCharactersInTextArea(document.getElementById('editor'));
    //     document.getElementById('lineCount').innerHTML=countLineNumberInTextArea(document.getElementById('editor'));
    //     document.getElementById('hashTagsCount').innerHTML=hashTagCountInGivenText(document.getElementById('editor').value);
    //     if(xhttp){
    //         xhttp.abort();
    //         xhttp=null;
    //     }
    //     document.getElementById("tag-name").innerHTML="";
    //     document.getElementById("tag-name").style.display="none";
    //
    //     document.getElementById('editor').value=event.data;
    //     if(event.key.length<2 || event.key==="Backspace") {
    //         var tagName=AlertPrevWord();
    //         if(tagName[0]==="@"){
    //             var tagNameRegex = /^@[^@#]+$/g;
    //             if(tagName.length>2 && tagName.match(tagNameRegex)!==null){
    //                 document.getElementById('tag-name').style.marginTop=(getCaretCoordinates(this, this.selectionEnd).top+185)+"px";
    //                 instaAjaxCall(tagName);
    //             }
    //         }
    //     }
    // }



    div.onkeyup=function(event){
        document.getElementById('lineCount').innerHTML=countLineNumberInTextArea(document.getElementById('editor'));
        document.getElementById('charCount').innerHTML=countCharactersInTextArea(document.getElementById('editor'));
        document.getElementById('hashTagsCount').innerHTML=hashTagCountInGivenText(document.getElementById('editor').value);
    }



    inputHandler = function(event) {

        if(event.inputType==="insertText" || event.inputType==="insertCompositionText") {

            if(event.target.value.length<input.length){
                console.info("delete");
            }
            else if(event.target.value.length===input.length+1){
                if (event.data===" "){
                    console.info("space");
                }
                else{
                    inp(event.data,true,1);
                }
            }
            else if (event.target.value.length>input.length){

                inp(event.data,false,event.data.length);

            }


            input=event.target.value;

        }
        else {
            input=event.target.value;
        }
        
    }
    
    function inp(inputData,oneChar,length) {
        var ch;
        var charStr;

        if(document.getElementById("fontChosen").getAttribute("data-font")==="NORMAL"){
            //
            //boooooom........
            console.info("normal text only...");

        }
        else{

            if(oneChar){
                if(inputData.length===1){
                    charStr=inputData;
                }
                else{
                    charStr=inputData.charAt(inputData.length-1);
                }
            }
            else{
                charStr=inputData;
            }

            var fontName = document.getElementById("fontChosen").getAttribute("data-font");
            ch = changeFontStyleForGivenText(charStr, fontName);
            if(oneChar){
                replaceSelectedText(document.getElementById('editor'), ch,"insertAtCaret",length);
            }
            else{
                replaceSelectedText(document.getElementById('editor'), ch,"swipedText",length);
            }

            return false;

        }

        if(xhttp){
            xhttp.abort();
            xhttp=null;
        }
        document.getElementById("tag-name").innerHTML="";
        document.getElementById("tag-name").style.display="none";

        var tagName=AlertPrevWord();
        console.log(tagName);
        if(tagName[0]==="@"){
            var tagNameRegex = /^@[^@#]+$/g;
            if(tagName.length>2 && tagName.match(tagNameRegex)!==null){
                document.getElementById('tag-name').style.marginTop=(getCaretCoordinates(this, this.selectionEnd).top+185)+"px";
                instaAjaxCall(tagName);
            }
        }
    }

    function instaAjaxCall(tagName){

        var textParam=tagName.slice(1,tagName.length).trim().toLowerCase();

        document.getElementById("tag-name").style.display="";
        document.getElementById("tag-name").innerHTML="<center><img src='/hackeroverflow/images/loading.svg' style='height: 100px;width: 100px;margin-top: 100px;'></center>";

        var url="https://www.instagram.com/web/search/topsearch/?context=user&query="+encodeURI(textParam)+"&rank_token=0.7700473304112787&include_reel=true";
        xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (this.readyState === 4 && this.status === 200) {

                var tagnameDiv=document.getElementById("tag-name");
                var jsonObject=JSON.parse(this.responseText);
                var usersArray=jsonObject.users;
                document.getElementById("tag-name").innerHTML="";

                for(var p=0;p<usersArray.length;p++){

                    var positionObject=usersArray[p];

                    if(positionObject.hasOwnProperty('user')) {
                        var userObject = positionObject.user;
                        var span = document.createElement("span");
                        var usernameText = document.createTextNode(userObject.username);
                        span.appendChild(usernameText);

                        var usernameDiv = document.createElement("div");
                        usernameDiv.setAttribute("style", "margin-top: 6px;font-family: Montserrat-Bold;");

                        if (userObject.is_verified) {

                            var verifiedImage = document.createElement("img");
                            verifiedImage.setAttribute("src", "/hackeroverflow/images/verified.png");
                            verifiedImage.setAttribute("style", "height: 10px;width: 10px;margin-left: 5px;");
                            usernameDiv.appendChild(span);
                            usernameDiv.appendChild(verifiedImage);

                        } else {

                            usernameDiv.appendChild(span);

                        }

                        var fullnameDiv = document.createElement("div");
                        fullnameDiv.setAttribute("style", "color: #7E7E7E;font-family: Montserrat;font-weight: 500;");
                        var fullnameText = document.createTextNode(userObject.full_name);
                        fullnameDiv.appendChild(fullnameText);

                        var rightElement = document.createElement("div");
                        rightElement.appendChild(usernameDiv);
                        rightElement.appendChild(fullnameDiv);

                        var profileImage = document.createElement("img");
                        profileImage.setAttribute("src", decodeURIComponent(userObject.profile_pic_url));
                        profileImage.setAttribute("style", "height: 30px;width: 30px;border-radius: 20px;float: right;margin-top: 10px;");

                        var leftElement = document.createElement("div");
                        leftElement.appendChild(profileImage);

                        var rowMainDiv = document.createElement("div");
                        rowMainDiv.setAttribute("data-username",userObject.username);
                        rowMainDiv.setAttribute("onclick","replaceTagname(document.getElementById('editor'),this.getAttribute('data-username'))");
                        rowMainDiv.setAttribute("style", "width: inherit;height: 50px;display: grid;\n" +
                            "grid-template-columns: 50px 195px;grid-column-gap: 13px;border-bottom: #D6D6D6 1px solid;");
                        rowMainDiv.appendChild(leftElement);
                        rowMainDiv.appendChild(rightElement);

                        tagnameDiv.appendChild(rowMainDiv);
                    }
                    document.getElementById("editor").focus();

                }

            }
        };
        xhttp.open("GET", url, true);
        xhttp.send();

    }
    div.addEventListener('input', inputHandler);

    function replaceTagname(el,div) {

        var sel = getInputSelection(el), val = el.value;
        var newText = "@"+div;
        var tagNamelength=AlertPrevWord();
        sel.start=sel.start-tagNamelength.length;
        el.value = val.slice(0, sel.start) + newText + val.slice(sel.end);
        el.focus();
        el.selectionStart=sel.start;
        el.selectionEnd=sel.start+newText.length;
        document.getElementById('charCount').innerHTML=countCharactersInTextArea(document.getElementById('editor'));
        document.getElementById('hashTagsCount').innerHTML=hashTagCountInGivenText(document.getElementById('editor').value);
        document.getElementById('tag-name').style.display='none';
        return true;

    }


</script>

</body>
</html>
