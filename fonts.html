<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" contentType="text/html;">
	<title></title>

    <style>

        .tagname{

            background-color: #FAFAFA;
            height: 300px;
            width:275px;
            position: absolute;
            border-radius: 5px;
            /*border: gray 1px solid;*/
            box-shadow: 0.4px 0.4px 0.4px 0.4px gray;
            font-family: Roboto, Helvetica, sans-serif;
            overflow: scroll;

        }

        body{
            position: relative;
        }

    </style>

</head>
<body bgcolor="pink" onclick="document.getElementById('tag-name').style.display='none';">
<div style="position: absolute;">
<label>Choose a font : </label>
<div>
    <button onclick="if(document.getElementById('fontslet').style.display==='none'){document.getElementById('fontslet').style.display='';}else{document.getElementById('fontslet').style.display='none'}document.getElementById('editor').focus()">show text styles</button>
<div id="fontslet" data-font="NORMAL" style="display: none;">

    <button value="NORMAL" onclick="changeValue(this)">Normal text</button>
    <button value="NORMAL_SANS" onclick="changeValue(this)">sans text</button>
  <button value="BOLD_SANS" onclick="changeValue(this)">boldsans text</button>
  <button value="ITALIC_SANS" onclick="changeValue(this)">italicsans text</button>
  <button value="BOLD_ITALIC_SANS" onclick="changeValue(this)">bold & italic sans </button>
    <button value="BUBBLE_TEXT_BLACKED" onclick="changeValue(this)">bubble blacked</button>
    <button value="SQUARE_TEXT_NORMAL" onclick="changeValue(this)">square text</button>
    <button value="SQUARE_TEXT_BLACKED" onclick="changeValue(this)">bold blacked</button>
    <button value="MONOSPACE_TEXT" onclick="changeValue(this)">monospace text</button>
<!--    <button value="CURSIVE_TEXT" onclick="changeValue(this)">cursive text</button>-->
<!--    <button value="DOUBLE_OUTLINE_TEXT" onclick="changeValue(this)">double outline</button>-->
    <button value="SPACING_TEXT" onclick="changeValue(this)">spacing text</button>
</div>
<div id="alert" style="color: #ff0000;font-weight: normal;font-size: 18px;position: absolute;height: 40px;border: red 1px solid;background-color: #ffcccb;display: none;margin-left: 400px;"></div>
</div>

<div style="position: relative;width: 380px;height: 630px;margin-left: auto;margin-right: auto;"><textarea id="editor" maxlength="2200" style="outline: none;height: 625px;background-color: white;resize: none;border: none;margin-top: 75px;font-size: 16px;font-family: 'Roboto Thin', 'Helvetica Neue',sans-seriff;font-weight: 400;width: 375px;letter-spacing: normal;padding:10px 0px 11px 8px;border-radius: 10px;" autocapitalize="none" spellcheck="true"  placeholder="Tap here to writing."></textarea>

    <div><span>Characters&nbsp;&nbsp; : &nbsp;</span><span id="charCount">0</span><span>&nbsp;/ 2200</span></div>
    <div><span>Lines Used &nbsp;: &nbsp;</span><span id="lineCount">1</span></div>
    <div><span>Hash Count : &nbsp;</span><span id="hashTagsCount">0<span>&nbsp;/ 30</span></span></div>
</div>

    <div class="tagname" id="tag-name" style="">

</div>



</div>



<script type="text/javascript">

    document.getElementById("tag-name").style.display="none";

var fonts={

    "NORMAL":{"CAPSFIRST":"A","CAPSLAST":"Z","SMALLFIRST":"a","SMALLLAST":"z","NUMBERFIRST":"0","NUMBERLAST":"9","STATUS":{"containsall":"1:s","REGEX":"[A-Za-z0-9]"}},

    "NORMAL_SANS":{"CAPSFIRST":"𝖠","CAPSLAST":"𝖹","SMALLFIRST":"𝖺","SMALLLAST":"𝗓","NUMBERFIRST":"𝟢","NUMBERLAST":"𝟫","STATUS":{"containsall":"1:s","REGEX":"[A-Za-z0-9]"}},

"BOLD_SANS":{"CAPSFIRST":"𝗔","CAPSLAST":"𝗭","SMALLFIRST":"𝗮","SMALLLAST":"𝘇","NUMBERFIRST":"𝟬","NUMBERLAST":"𝟵","STATUS":{"containsall":"1:s","REGEX":"[A-Za-z0-9]"}},

"ITALIC_SANS":{"CAPSFIRST":"𝘈","CAPSLAST":"𝘡","SMALLFIRST":"𝘢","SMALLLAST":"𝘻","STATUS":{"containsall":"0:s","notcontains":"numbers","REGEX":"[A-Za-z]"}},

"BOLD_ITALIC_SANS":{"CAPSFIRST":"𝘼","CAPSLAST":"𝙕","SMALLFIRST":"𝙖","SMALLLAST":"𝙯","STATUS":{"containsall":"0:s","notcontains":"numbers","REGEX":"[A-Za-z]"}},

"BUBBLE_TEXT_BLACKED":{"CAPSFIRST":"🅐","CAPSLAST":"🅩","SMALLFIRST":"🅐","SMALLLAST":"🅩","NUMBERFIRST":"➊","NUMBERLAST":"➒","STATUS":{"containsall":"1:e","exceptionlist":"0","changeto":"⓿","REGEX":"[A-Za-z1-9]"}},

"SQUARE_TEXT_NORMAL":{"CAPSFIRST":"🄰","CAPSLAST":"🅉","SMALLFIRST":"🄰","SMALLLAST":"🅉","STATUS":{"containsall":"0:s","notcontains":"numbers","REGEX":"[A-Za-z]"}},

"SQUARE_TEXT_BLACKED":{"CAPSFIRST":"🅰","CAPSLAST":"🆉","SMALLFIRST":"🅰","SMALLLAST":"🆉","STATUS":{"containsall":"0:s","notcontains":"numbers","REGEX":"[A-Za-z]"}},

"MONOSPACE_TEXT":{"CAPSFIRST":"𝙰","CAPSLAST":"𝚉","SMALLFIRST":"𝚊","SMALLLAST":"𝚣","NUMBERFIRST":"𝟶","NUMBERLAST":"𝟿","STATUS":{"containsall":"1:s","REGEX":"[A-Za-z0-9]"}},

// "CURSIVE_TEXT":{"CAPSFIRST":"𝒜","CAPSLAST":"𝒵","SMALLFIRST":"𝒶","SMALLLAST":"𝓏","STATUS":{"containsall":"0:s","notcontains":"numbers","REGEX":"[A-Za-z]"}},
//
// "DOUBLE_OUTLINE_TEXT":{"CAPSFIRST":"𝔸","CAPSLAST":"ℤ","SMALLFIRST":"𝕒","SMALLLAST":"𝕫","NUMBERFIRST":"𝟘","NUMBERLAST":"𝟡","STATUS":{"containsall":"1:s","REGEX":"[A-Za-z0-9]"}},

"SPACING_TEXT":{"CAPSFIRST":"Ａ","CAPSLAST":"Ｚ","SMALLFIRST":"ａ","SMALLLAST":"ｚ","NUMBERFIRST":"０","NUMBERLAST":"９","STATUS":{"containsall":"1:s","REGEX":"[A-Za-z0-9]"}},

"REGEXCHECK":[{"LIST":"ABCDEFGHIJKLMNOPQRSTUVWXYZ𝖠𝖡𝖢𝖣𝖤𝖥𝖦𝖧𝖨𝖩𝖪𝖫𝖬𝖭𝖮𝖯𝖰𝖱𝖲𝖳𝖴𝖵𝖶𝖷𝖸𝖹𝗔𝗕𝗖𝗗𝗘𝗙𝗚𝗛𝗜𝗝𝗞𝗟𝗠𝗡𝗢𝗣𝗤𝗥𝗦𝗧𝗨𝗩𝗪𝗫𝗬𝗭𝘈𝘉𝘊𝘋𝘌𝘍𝘎𝘏𝘐𝘑𝘒𝘓𝘔𝘕𝘖𝘗𝘘𝘙𝘚𝘛𝘜𝘝𝘞𝘟𝘠𝘡𝘼𝘽𝘾𝘿𝙀𝙁𝙂𝙃𝙄𝙅𝙆𝙇𝙈𝙉𝙊𝙋𝙌𝙍𝙎𝙏𝙐𝙑𝙒𝙓𝙔𝙕🅐🅑🅒🅓🅔🅕🅖🅗🅘🅙🅚🅛🅜🅝🅞🅟🅠🅡🅢🅣🅤🅥🅦🅧🅨🅩🄰🄱🄲🄳🄴🄵🄶🄷🄸🄹🄺🄻🄼🄽🄾🄿🅀🅁🅂🅃🅄🅅🅆🅇🅈🅉🅰🅱🅲🅳🅴🅵🅶🅷🅸🅹🅺🅻🅼🅽🅾🅿🆀🆁🆂🆃🆄🆅🆆🆇🆈🆉𝙰𝙱𝙲𝙳𝙴𝙵𝙶𝙷𝙸𝙹𝙺𝙻𝙼𝙽𝙾𝙿𝚀𝚁𝚂𝚃𝚄𝚅𝚆𝚇𝚈𝚉ＡＢＣＤＥＦＧＨＩＪＫＬＭＮＯＰＱＲＳＴＵＶＷＸＹＺ","NAME":"caps"},
	{"LIST":"abcdefghijklmnopqrstuvwxyz𝖺𝖻𝖼𝖽𝖾𝖿𝗀𝗁𝗂𝗃𝗄𝗅𝗆𝗇𝗈𝗉𝗊𝗋𝗌𝗍𝗎𝗏𝗐𝗑𝗒𝗓𝗮𝗯𝗰𝗱𝗲𝗳𝗴𝗵𝗶𝗷𝗸𝗹𝗺𝗻𝗼𝗽𝗾𝗿𝘀𝘁𝘂𝘃𝘄𝘅𝘆𝘇𝘢𝘣𝘤𝘥𝘦𝘧𝘨𝘩𝘪𝘫𝘬𝘭𝘮𝘯𝘰𝘱𝘲𝘳𝘴𝘵𝘶𝘷𝘸𝘹𝘺𝘻𝙖𝙗𝙘𝙙𝙚𝙛𝙜𝙝𝙞𝙟𝙠𝙡𝙢𝙣𝙤𝙥𝙦𝙧𝙨𝙩𝙪𝙫𝙬𝙭𝙮𝙯🅐🅑🅒🅓🅔🅕🅖🅗🅘🅙🅚🅛🅜🅝🅞🅟🅠🅡🅢🅣🅤🅥🅦🅧🅨🅩🄰🄱🄲🄳🄴🄵🄶🄷🄸🄹🄺🄻🄼🄽🄾🄿🅀🅁🅂🅃🅄🅅🅆🅇🅈🅉🅰🅱🅲🅳🅴🅵🅶🅷🅸🅹🅺🅻🅼🅽🅾🅿🆀🆁🆂🆃🆄🆅🆆🆇🆈🆉𝚊𝚋𝚌𝚍𝚎𝚏𝚐𝚑𝚒𝚓𝚔𝚕𝚖𝚗𝚘𝚙𝚚𝚛𝚜𝚝𝚞𝚟𝚠𝚡𝚢𝚣ａｂｃｄｅｆｇｈｉｊｋｌｍｎｏｐｑｒｓｔｕｖｗｘｙｚ","NAME":"small"},
	{"LIST":"0123456789𝟢𝟣𝟤𝟥𝟦𝟧𝟨𝟩𝟪𝟫𝟬𝟭𝟮𝟯𝟰𝟱𝟲𝟳𝟴𝟵⓿➊➋➌➍➎➏➐➑➒𝟶𝟷𝟸𝟹𝟺𝟻𝟼𝟽𝟾𝟿０１２３４５６７８９","NAME":"number"}
]
};

function getInputSelection(el) {
  var start = 0, end = 0, normalizedValue, range,
          textInputRange, len, endRange;

  if (typeof el.selectionStart == "number" && typeof el.selectionEnd == "number") {
    start = el.selectionStart;
    end = el.selectionEnd;
  } else {
    range = document.selection.createRange();

    if (range && range.parentElement() === el) {
      len = el.value.length;
      normalizedValue = el.value.replace(/\r\n/g, "\n");

      // Create a working TextRange that lives only in the input
      textInputRange = el.createTextRange();
      textInputRange.moveToBookmark(range.getBookmark());

      // Check if the start and end of the selection are at the very end
      // of the input, since moveStart/moveEnd doesn't return what we want
      // in those cases
      endRange = el.createTextRange();
      endRange.collapse(false);

      if (textInputRange.compareEndPoints("StartToEnd", endRange) > -1) {
        start = end = len;
      } else {
        start = -textInputRange.moveStart("character", -len);
        start += normalizedValue.slice(0, start).split("\n").length - 1;

        if (textInputRange.compareEndPoints("EndToEnd", endRange) > -1) {
          end = len;
        } else {
          end = -textInputRange.moveEnd("character", -len);
          end += normalizedValue.slice(0, end).split("\n").length - 1;
        }
      }
    }
  }

  return {
    start: start,
    end: end
  };
}

function replaceSelectedText(el, text) {
  var sel = getInputSelection(el), val = el.value;
  let newText = translateSelectRange(text);
  console.log(sel.start+" : "+sel.end);
  el.value = val.slice(0, sel.start) + newText + val.slice(sel.end);
    el.focus();
  el.selectionStart=sel.start;
  el.selectionEnd=sel.start+newText.length;
  document.getElementById('charCount').innerHTML=countCharactersInTextArea(document.getElementById('editor'));
    document.getElementById('hashTagsCount').innerHTML=hashTagCountInGivenText(document.getElementById('editor').value);
  return true;
}

function translateSelectRange(text) {

  var newtext="";
  text=[...text];
  for (x=0;x<text.length;x++) {

      var char = text[x];
      var array = fonts["REGEXCHECK"];
      let bool = false;
      var identity = "";
      var newchar;
      var toFont = document.getElementById("fontslet").getAttribute("data-font");
      var fontStyle = fonts[toFont];
      var indexNumber = 0;
      var caps = "ABCDEFGHIJKLMNOPQRSTUVWXYZABCDEFGHIJKLMNOPQRSTUVWXYZABCDEFGHIJKLMNOPQRSTUVWXYZABCDEFGHIJKLMNOPQRSTUVWXYZABCDEFGHIJKLMNOPQRSTUVWXYZABCDEFGHIJKLMNOPQRSTUVWXYZABCDEFGHIJKLMNOPQRSTUVWXYZABCDEFGHIJKLMNOPQRSTUVWXYZABCDEFGHIJKLMNOPQRSTUVWXYZABCDEFGHIJKLMNOPQRSTUVWXYZ";
      var small = "abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz";
      var number = "0123456789012345678901234567890123456789012345678901234567890123456789";
      var diff;

      for (let i = 0; i < array.length; i++) {

        if (bool === false) {

          if ([...array[i]["LIST"]].indexOf(char) !== -1) {

                  indexNumber = [...array[i]["LIST"]].indexOf(char);

            identity = array[i]["NAME"];
            bool = true;
          }

        }
      }
      let normalChar = "";
      if (identity === "number") {
        normalChar = number[indexNumber];
      } else if (identity === "small") {
        normalChar = small[indexNumber];
      } else if (identity === "caps") {
        normalChar = caps[indexNumber];
      }

      if (bool === true) {
if(fontStyle["STATUS"]["containsall"][2] === "s") {
    if (fontStyle["STATUS"]["containsall"][0] === "0") {
        if (fontStyle["STATUS"]["notcontains"].includes(identity)) {

            if (/[A-Z]/.test(normalChar)) {
                diff = "𝖠".codePointAt(0) - "A".codePointAt(0);
            } else if (/[a-z]/.test(normalChar)) {
                diff = "𝖺".codePointAt(0) - "a".codePointAt(0);
            } else if (/[0-9]/.test(normalChar)) {
                diff = "𝟢".codePointAt(0) - "0".codePointAt(0);
            }
            newchar = String.fromCodePoint(normalChar.codePointAt(0) + diff);

        } else {

            if (/[A-Z]/.test(normalChar)) {
                diff = fontStyle["CAPSFIRST"].codePointAt(0) - "A".codePointAt(0);
            } else if (/[a-z]/.test(normalChar)) {
                diff = fontStyle["SMALLFIRST"].codePointAt(0) - "a".codePointAt(0);
            } else if (/[0-9]/.test(normalChar)) {
                diff = fontStyle["NUMBERFIRST"].codePointAt(0) - "0".codePointAt(0);
            }
            newchar = String.fromCodePoint(normalChar.codePointAt(0) + diff);

        }
    } else {

        if (/[A-Z]/.test(normalChar)) {
            diff = fontStyle["CAPSFIRST"].codePointAt(0) - "A".codePointAt(0);
        } else if (/[a-z]/.test(normalChar)) {
            diff = fontStyle["SMALLFIRST"].codePointAt(0) - "a".codePointAt(0);
        } else if (/[0-9]/.test(normalChar)) {
            diff = fontStyle["NUMBERFIRST"].codePointAt(0) - "0".codePointAt(0);
        }
        newchar = String.fromCodePoint(normalChar.codePointAt(0) + diff);

    }

}

else{

    if(fontStyle["STATUS"]["exceptionlist"].indexOf(normalChar)!==-1){
        newchar=[...fontStyle["STATUS"]["changeto"]][fontStyle["STATUS"]["exceptionlist"].indexOf(normalChar)];
    }
    else {
        if (fontStyle["STATUS"]["containsall"][0] === "0") {
            if (fontStyle["STATUS"]["notcontains"].includes(identity)) {

                if (/[A-Z]/.test(normalChar)) {
                    diff = "𝖠".codePointAt(0) - "A".codePointAt(0);
                } else if (/[a-z]/.test(normalChar)) {
                    diff = "𝖺".codePointAt(0) - "a".codePointAt(0);
                } else if (/[0-9]/.test(normalChar)) {
                    diff = "𝟢".codePointAt(0) - "0".codePointAt(0);
                }
                newchar = String.fromCodePoint(normalChar.codePointAt(0) + diff);

            } else {

                if (/[A-Z]/.test(normalChar)) {
                    diff = fontStyle["CAPSFIRST"].codePointAt(0) - "A".codePointAt(0);
                } else if (/[a-z]/.test(normalChar)) {
                    diff = fontStyle["SMALLFIRST"].codePointAt(0) - "a".codePointAt(0);
                } else if (/[0-9]/.test(normalChar)) {
                    diff = fontStyle["NUMBERFIRST"].codePointAt(0) - "1".codePointAt(0);
                }
                newchar = String.fromCodePoint(normalChar.codePointAt(0) + diff);

            }
        } else {

            if (/[A-Z]/.test(normalChar)) {
                diff = fontStyle["CAPSFIRST"].codePointAt(0) - "A".codePointAt(0);
            } else if (/[a-z]/.test(normalChar)) {
                diff = fontStyle["SMALLFIRST"].codePointAt(0) - "a".codePointAt(0);
            } else if (/[0-9]/.test(normalChar)) {
                diff = fontStyle["NUMBERFIRST"].codePointAt(0) - "1".codePointAt(0);
            }
            newchar = String.fromCodePoint(normalChar.codePointAt(0) + diff);

        }
    }

}

      } else {
        newchar = char;
      }

      newtext += newchar;

  }
  return newtext;

}

	 function changeValue(e){

		var el = document.getElementById("fontslet");
	 	el.setAttribute("data-font",e.getAttribute("value"));
         var txtarea = document.getElementById("editor");
         var start = txtarea.selectionStart;
         var finish = txtarea.selectionEnd;
         var sel = txtarea.value.substring(start, finish);


       replaceSelectedText(document.getElementById("editor"),sel);

	 }
var div = document.getElementById("editor");


function insertAtCaret(areaId, text) {
  var txtarea = document.getElementById(areaId);
  if (!txtarea) {
    return;
  }

  var scrollPos = txtarea.scrollTop;
  var strPos = 0;
  var br = ((txtarea.selectionStart || txtarea.selectionStart === '0') ?
          "ff" : (document.selection ? "ie" : false));
  if (br === "ie") {
    txtarea.focus();
    var range = document.selection.createRange();
    range.moveStart('character', -txtarea.value.length);
    strPos = range.text.length;
  } else if (br === "ff") {
    strPos = txtarea.selectionStart;
  }

  var front = (txtarea.value).substring(0, strPos);
  var back = (txtarea.value).substring(strPos, txtarea.value.length);
  txtarea.value = front + text + back;
  strPos = strPos + text.length;
  if (br === "ie") {
    txtarea.focus();
    var ieRange = document.selection.createRange();
    ieRange.moveStart('character', -txtarea.value.length);
    ieRange.moveStart('character', strPos);
    ieRange.moveEnd('character', 0);
    ieRange.select();
  } else if (br === "ff") {
    txtarea.selectionStart = strPos;
    txtarea.selectionEnd = strPos;
    txtarea.focus();
  }

  txtarea.scrollTop = scrollPos;
}

div.onkeypress = function(evt) {

    evt = evt || window.event;
    var charCode = (typeof evt.which == "undefined") ? evt.keyCode : evt.which;
    var charStr = String.fromCharCode(charCode);
    var ch;
    if(document.getElementById("fontslet").getAttribute("data-font")==="NORMAL"){

        //boooooom........
        ch=charStr;

    }
    else{
        if (charCode === 13 || charStr === " ") {
            //magic happens........
            ch=charStr;

        } else if (charCode) {

            var style = document.getElementById("fontslet").getAttribute("data-font");
            ch = translateClick(charStr, fonts[style]);
            insertAtCaret("editor", ch);
            return false;
        }
    }
    document.getElementById('charCount').innerHTML=div.value.length+ch.length;;
}

function translateClick (char,json)
{
	
    let diff;
    let character;
    var patt = new RegExp(json["STATUS"]["REGEX"]);

    if(json["STATUS"]["containsall"].split(":")[1]==="s") {

        if (patt.test(char)) {
            if (/[A-Z]/.test(char)) {
                diff = json["CAPSFIRST"].codePointAt(0) - "A".codePointAt(0);
            } else if (/[a-z]/.test(char)) {
                diff = json["SMALLFIRST"].codePointAt(0) - "a".codePointAt(0);
            } else if (/[0-9]/.test(char)) {
                diff = json["NUMBERFIRST"].codePointAt(0) - "0".codePointAt(0);
            }
            character = String.fromCodePoint(char.codePointAt(0) + diff);

        } else if (/[A-Za-z0-9]/.test(char)) {

            if (/[A-Z]/.test(char)) {
                diff = "𝖠".codePointAt(0) - "A".codePointAt(0);
            } else if (/[a-z]/.test(char)) {
                diff = "𝖺".codePointAt(0) - "a".codePointAt(0);
            } else if (/[0-9]/.test(char)) {
                diff = "𝟢".codePointAt(0) - "0".codePointAt(0);
            }
            character = String.fromCodePoint(char.codePointAt(0) + diff);
        } else {
            character = char;
        }

    }
    else{

        if(json["STATUS"]["exceptionlist"].includes(char)){
            //change to the exception font styles.
            character=json["STATUS"]["changeto"];
        }
        else{
            if (patt.test(char)) {
                if (/[A-Z]/.test(char)) {
                    diff = json["CAPSFIRST"].codePointAt(0) - "A".codePointAt(0);
                } else if (/[a-z]/.test(char)) {
                    diff = json["SMALLFIRST"].codePointAt(0) - "a".codePointAt(0);
                } else if (/[0-9]/.test(char)) {
                    diff = json["NUMBERFIRST"].codePointAt(0) - "1".codePointAt(0);
                }
                character = String.fromCodePoint(char.codePointAt(0) + diff);

            } else if (/[A-Za-z0-9]/.test(char)) {

                if (/[A-Z]/.test(char)) {
                    diff = "𝖠".codePointAt(0) - "A".codePointAt(0);
                } else if (/[a-z]/.test(char)) {
                    diff = "𝖺".codePointAt(0) - "a".codePointAt(0);
                } else if (/[0-9]/.test(char)) {
                    diff = "𝟢".codePointAt(0) - "0".codePointAt(0);
                }
                character = String.fromCodePoint(char.codePointAt(0) + diff);
            } else {
                character = char;
            }
        }

    }
   
    return character;
}

function getCaretPosition(ctrl) {
    var start, end;
    if (ctrl.setSelectionRange) {
        start = ctrl.selectionStart;
        end = ctrl.selectionEnd;
    } else if (document.selection && document.selection.createRange) {
        var range = document.selection.createRange();
        start = 0 - range.duplicate().moveStart('character', -100000);
        end = start + range.text.length;
    }
    return {
        start: start,
        end: end
    }
}

function ReturnWord(text, caretPos) {
    var index = text.indexOf(caretPos);
    var preText = text.substring(0, caretPos);
    if (preText.indexOf(" ") > 0) {
        var words = preText.split(" ");
        return words[words.length - 1]; //return last word
    }
    else {
        return preText;
    }
}

function AlertPrevWord() {
    var text = document.getElementById("editor");
    var caretPos = GetCaretPosition(text)
    var word = ReturnWord(text.value, caretPos);
    if (word != null) {
        return word;
    }
    else{
        return "";
    }

}

function GetCaretPosition(ctrl) {
    var CaretPos = 0;   // IE Support
    if (document.selection) {
        ctrl.focus();
        var Sel = document.selection.createRange();
        Sel.moveStart('character', -ctrl.value.length);
        CaretPos = Sel.text.length;
    }
    // Firefox support
    else if (ctrl.selectionStart || ctrl.selectionStart === '0')
        CaretPos = ctrl.selectionStart;
    return (CaretPos);
}

div.onkeyup=function (event) {

    document.getElementById('charCount').innerHTML=countCharactersInTextArea(document.getElementById('editor'));
    document.getElementById('lineCount').innerHTML=countLineNumberInTextArea(document.getElementById('editor'));
    document.getElementById('hashTagsCount').innerHTML=hashTagCountInGivenText(document.getElementById('editor').value);
    document.getElementById("tag-name").innerHTML="";
    if(event.key.length<2 || event.key==="Backspace") {
        var tagName=AlertPrevWord();
        if(tagName[0]==="@"){

            let tagNameRegex = /^@[^@#]+$/g;
            if(tagName.length>2 && tagName.match(tagNameRegex)!==null){

                var textParam=tagName.slice(1,tagName.length).trim().toLowerCase();

                // document.getElementById("tag-name").style.marginTop=getCaretCoordinates().y+"px";
                document.getElementById("tag-name").style.display="";

                var url="https://www.instagram.com/web/search/topsearch/?context=user&query="+encodeURI(textParam)+"&rank_token=0.7700473304112787&include_reel=true";
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    if (this.readyState === 4 && this.status === 200) {

                        var tagnameDiv=document.getElementById("tag-name");
                        var jsonObject=JSON.parse(this.responseText);
                        var usersArray=jsonObject.users;
                        console.log(usersArray);

                        for(let p=0;p<usersArray.length;p++){

                            var positionObject=usersArray[p];

                            if(positionObject.hasOwnProperty('user')) {
                                var userObject = positionObject.user;
                                let span = document.createElement("span");
                                let usernameText = document.createTextNode(userObject.username);
                                span.appendChild(usernameText);

                                let usernameDiv = document.createElement("div");
                                usernameDiv.setAttribute("style", "margin-top: 6px;font-weight: 600;");

                                if (userObject.is_verified) {

                                    let verifiedImage = document.createElement("img");
                                    verifiedImage.setAttribute("src", "/hackeroverflow/images/verified.png");
                                    verifiedImage.setAttribute("style", "height: 10px;width: 10px;margin-left: 5px;");
                                    usernameDiv.appendChild(span);
                                    usernameDiv.appendChild(verifiedImage);

                                } else {

                                    usernameDiv.appendChild(span);

                                }

                                let fullnameDiv = document.createElement("div");
                                fullnameDiv.setAttribute("style", "color: #7E7E7E;font-weight: 400;");
                                let fullnameText = document.createTextNode(userObject.full_name);
                                fullnameDiv.appendChild(fullnameText);

                                let rightElement = document.createElement("div");
                                rightElement.appendChild(usernameDiv);
                                rightElement.appendChild(fullnameDiv);

                                let profileImage = document.createElement("img");
                                profileImage.setAttribute("src", decodeURIComponent(userObject.profile_pic_url));
                                profileImage.setAttribute("style", "height: 30px;width: 30px;border-radius: 20px;float: right;margin-top: 10px;");

                                let leftElement = document.createElement("div");
                                leftElement.appendChild(profileImage);

                                let rowMainDiv = document.createElement("div");
                                rowMainDiv.setAttribute("style", "width: inherit;height: 50px;display: grid;\n" +
                                    "grid-template-columns: 50px 195px;grid-column-gap: 13px;border-bottom: #D6D6D6 1px solid;");
                                rowMainDiv.appendChild(leftElement);
                                rowMainDiv.appendChild(rightElement);

                                tagnameDiv.appendChild(rowMainDiv);
                            }
                            document.getElementById("editor").focus();

                        }


                    }
                };
                xhttp.open("GET", url, true);
                xhttp.send();
            }



        }
    }
}

function getCaretCoordinates() {

    var sel = window.getSelection();
    var range = sel.getRangeAt(0);
    var div = document.createElement("span");
    div.setAttribute("id","created");
    range.insertNode(div);
    var el=document.getElementById('created');
    var x = el.offsetLeft, y = el.offsetTop-550;
    el.remove();

    return {x:x,y:y};

}

function countCharactersInTextArea(element) {

    return element.value.length;

}

function countLineNumberInTextArea(element) {

    var noOfLines=element.value.split(/\r*\n/);

    return noOfLines.length;

}

// function caretPos(el)
// {
//     var pos = 0;
//     // IE Support
//     if (document.selection)
//     {
//         el.focus ();
//         var Sel = document.selection.createRange();
//         var SelLength = document.selection.createRange().text.length;
//         Sel.moveStart ('character', -el.value.length);
//         pos = Sel.text.length - SelLength;
//     }
//     // Firefox support
//     else if (el.selectionStart || el.selectionStart === '0')
//         pos = el.selectionStart;
//
//     return pos;
//
// }

function hashTagCountInGivenText(text) {

    var hashTagRegex = /^#[a-z0-9]/g;
    let hashTags = 0;
    var textSpaceSplit=text.split(/[ |\n]/);

    for(let z=0;z<textSpaceSplit.length;z++) {
        if (textSpaceSplit[z].match(hashTagRegex)!==null) {
            hashTags += 1;

        }
    }

    if(hashTags>30){
        document.getElementById("alert").innerHTML = "Hashtag limit 30, remove others!";
        document.getElementById("alert").style.display="";
        document.getElementById("editor").blur();

        setTimeout(function(){
            document.getElementById("alert").innerHTML = '';
            document.getElementById("alert").style.display="none";
        }, 1000);
    }

    return hashTags;
}


</script>

</body>
</html>
